(()=>{"use strict";const e=["JPEG","JPG","PNG"],t=document.querySelector(".map__filters"),r=document.querySelector(".ad-form"),o=r.querySelector("#address"),a=r.querySelector("#avatar"),n=r.querySelector("#images"),s=r.querySelector(".ad-form__photo"),c=r.querySelector(".ad-form__reset"),l=r.querySelector("#type"),i=r.querySelector("#price"),u=r.querySelector("#timein"),d=r.querySelector("#timeout"),p=r.querySelector("#room_number"),m=r.querySelector("#capacity"),y=r.querySelector("#title"),h=(e,t)=>{e.classList.add(t+"--disabled"),Array.from(e.children).forEach((e=>{e.setAttribute("disabled","disabled")}))},f=(e,t)=>{e.classList.remove(t+"--disabled"),Array.from(e.children).forEach((e=>{e.removeAttribute("disabled")}))},g=e=>{r.reset(),m.setCustomValidity(""),i.setCustomValidity(""),y.setCustomValidity(""),e.setLatLng([35.6817,139.75388]),setTimeout((()=>{o.value=e.getLatLng().lat.toFixed(5)+", "+e.getLatLng().lng.toFixed(5)}),0)},v=()=>{const e=document.querySelector("#error").content.querySelector(".error").cloneNode(!0);document.addEventListener("keydown",(t=>{27===t.keyCode&&e.remove()})),document.addEventListener("click",(()=>{e.remove()})),e.style.zIndex=400,document.querySelector("main").appendChild(e)};let S={},_={},q={},C=[];const E=L.icon({iconUrl:"../img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),b=L.icon({iconUrl:"../img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),x=(e,t,r,o)=>L.marker({lat:e,lng:t},{draggable:o,icon:r}),k=(e,t)=>{C&&(C.forEach((e=>{e.remove()})),C=[]),e.slice(0,10).forEach((e=>{const r=x(e.location.lat,e.location.lng,E,!1),o=t(e);r.bindPopup(o,{keepInView:!0}),C.push(r)})),C.forEach((e=>{e.addTo(S)}))},A=["palace","flat","house","bungalow"],V=["Дворец","Квартира","Дом","Бунгало"],w=document.querySelector("#card").content.querySelector(".popup"),T=(e,t,r,o,a)=>{const n=document.createDocumentFragment();return e.forEach((e=>{const s=((e,t,r)=>{const o=document.createElement(e);return t&&o.classList.add(t),o})(t,r);o&&s.classList.add("popup__feature--"+e),a&&(s.src=e,s.width=45,s.height=40,s.alt="Фотография жилья"),n.appendChild(s)})),n},z=({author:e,offer:t})=>{const r=w.cloneNode(!0);return r.querySelector(".popup__title").textContent=t.title,r.querySelector(".popup__text--address").textContent=t.address,r.querySelector(".popup__text--price").textContent=t.price+" ₽/ночь",r.querySelector(".popup__type").textContent=(e=>{let t=0,r="";return A.forEach(((r,o)=>{r===e&&(t=o)})),r=V[t],r})(t.type),r.querySelector(".popup__text--capacity").textContent=t.rooms+" комнаты для "+t.guests+" гостей",r.querySelector(".popup__text--time").textContent=t.checkin+" выезд до "+t.checkout,r.querySelector(".popup__features").innerHTML="",r.querySelector(".popup__features").appendChild(T(t.features,"li","popup__feature",!0)),r.querySelector(".popup__description").textContent=t.description,r.querySelector(".popup__photos").innerHTML="",r.querySelector(".popup__photos").appendChild(T(t.photos,"img","popup__photo",!1,!0)),r.querySelector(".popup__avatar").src=e.avatar,r},F=document.querySelector(".map__filters"),I=F.querySelectorAll(".map__filter"),P=F.querySelector("#housing-type"),D=F.querySelector("#housing-price"),N=F.querySelector("#housing-rooms"),U=F.querySelector("#housing-guests"),j=F.querySelectorAll(".map__checkbox"),G=e=>{let t=e.slice();return"any"!=P.value&&(t=(e=>{const t=P.value;let r=[];return r=e.filter((e=>e.offer.type===t)),r})(t)),"any"!=D.value&&(t=(e=>{let t=[];return t=e.filter((e=>(e=>{switch(D.value){case"low":return e<=1e4;case"middle":return e>1e4&&e<=5e4;case"high":return e>=5e4}})(e.offer.price))),t})(t)),"any"!=N.value&&(t=(e=>{const t=N.value;let r=[];return r=e.filter((e=>e.offer.rooms.toString()===t)),r})(t)),"any"!=U.value&&(t=(e=>{let t=[];return t=e.filter((e=>(e=>{switch(U.value){case"0":return e>2;case"1":return 1===e;case"2":return 2===e}})(e.offer.guests))),t})(t)),t=(e=>(j.forEach((t=>{t.checked&&(e=e.filter((e=>e.offer.features.some((e=>e===t.value)))))})),e))(t),t};var M,H,J,O,R,W,B;h(t,".map__filters"),h(r,".ad-form"),M=()=>{f(r,".ad-form")},S=L.map("map-canvas").on("load",(()=>{M()})).setView({lat:35.6817,lng:139.753882},10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(S),H=e=>{o.value=e.lat.toFixed(5)+", "+e.lng.toFixed(5)},_=x(35.6817,139.75388,b,!0).on("moveend",(e=>{q=e.target.getLatLng(),H(q)})),_.addTo(S),J=_,O=(e,t,r)=>{fetch("https://22.javascript.pages.academy/keksobooking/data",{method:"POST",headers:{"Content-Type":"multipart/form-data"},body:e}).then((e=>{e.ok?t():r()})).catch((()=>{r()}))},(()=>{const e=y.getAttribute("minlength"),t=y.getAttribute("maxlength");y.addEventListener("input",(()=>{const r=y.value.length;r<e?y.setCustomValidity("Еще "+(e-r)+" символов"):r>t?y.setCustomValidity("Удалите "+(r-t)+" символов"):y.setCustomValidity(""),y.reportValidity()}))})(),l.addEventListener("change",(()=>{const e=(()=>{switch(l.value){case"bungalow":return 0;case"flat":return 1e3;case"house":return 5e3;case"palace":return 1e4}})();i.setAttribute("min",e),i.setAttribute("placeholder",e),i.value&&(i.value<e?i.setCustomValidity("Цена за указанный тип жилья не может быть ниже "+e):i.setCustomValidity(""),i.reportValidity())})),i.addEventListener("input",(()=>{if(i.value){const e=parseInt(i.getAttribute("min"),10);i.value<e?i.setCustomValidity("Цена за указанный тип жилья не может быть ниже "+e):i.setCustomValidity(""),i.reportValidity()}})),[p,m].forEach((e=>{e.addEventListener("change",(()=>{(()=>{switch(p.value){case"100":return["0"];case"3":return["3","2","1"];case"2":return["2","1"];case"1":return["1"]}})().some((e=>e===m.value))?m.setCustomValidity(""):m.setCustomValidity("Неподходящее значение"),m.reportValidity()}))})),o.value="35.6817, 139.75388",o.setAttribute("readonly","readonly"),[u,d].forEach((e=>{e.addEventListener("change",(e=>{e.target===d?u.value=d.value:d.value=u.value}))})),(e=>{c.addEventListener("click",(()=>g(e)))})(J),(e=>{r.addEventListener("submit",(t=>{t.preventDefault();const r=new FormData(t.target);e(r,(()=>{(()=>{const e=document.querySelector("#success").content.querySelector(".success").cloneNode(!0);document.addEventListener("keydown",(t=>{27===t.keyCode&&e.remove()})),document.addEventListener("click",(()=>{e.remove()})),e.style.zIndex=400,document.querySelector("main").appendChild(e)})(),g()}),v)}))})(O),R=(e,t)=>{const o=new FileReader;o.addEventListener("load",(()=>{t?r.querySelector("#avatar-image").src=o.result:(e=>{const t=document.createElement("img");t.src=e,t.setAttribute("width","40"),t.setAttribute("height","44"),t.alt="Фотография жилья",s.appendChild(t)})(o.result)})),o.readAsDataURL(e)},[n,a].forEach((t=>{const r=t===a;t.addEventListener("change",(()=>{t.setCustomValidity(""),Array.from(t.files).forEach((o=>{const a=o.name.toUpperCase();return e.some((e=>a.endsWith(e)))?R(o,r):t.setCustomValidity("Неверный формат изображения")})),t.reportValidity()}))})),W=e=>{k(e,z),f(t,".map__filters"),((e,t)=>{Array.from(I).concat(Array.from(j)).forEach((t=>{t.addEventListener("change",(()=>{(e=>{((e,t)=>{let r={};clearTimeout(r),r=setTimeout(e,t)})((()=>k(e,z)),500)})(G(e))}))}))})(e)},B=e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent="Произошла ошибка!",document.body.append(t),setTimeout((()=>{t.remove()}),e)},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{if(200===e.status)return e.json();throw new Error("Не удалось получить данные")})).then((e=>{W(e)})).catch((e=>{B(e)}))})();
//# sourceMappingURL=main.bundle.js.map